# Проект - Рекомендательная система для интернет-магазина.
## Клиент компании заинтересован в повышении прибыли от допродаж в интернет-магазине на 20 %. Для решения задачи - реализовать рекомендательную систему на главной странице сайта интернет-магазина. Целевая техническая метрика - Precision@3.

## Набор данных от заказчика
## events — датасет с событиями:

### timestamp — время события
### visitorid — идентификатор пользователя
### event — тип события
### itemid — идентификатор объекта
### transactionid — идентификатор транзакции, если она проходила
### category_tree — файл с деревом категорий (можно восстановить дерево):

### category_id — идентификатор категорий
### parent_id — идентификатор родительской категории
### item_properties — файл с свойствами товаров:

### timestamp — момент записи значения свойства
### item_id — идентификатор объекта
### property — свойство, кажется, они все, кроме категории, захешированы
### value — значение свойства
### Формат входных данных для обучения (формат, факторы)

### day_of_week,  Month, Day, Hour,  - признаки, сгенерированные на основе исходного признака event_datetime;
### Day Period - категориальный признак, производная от Hour (утро, день, вечер, ночь);
#  обучение, валидация
### Для проекта была выбрана модель LightFM. Для обучения итоговой модели используется датасет events от заказчика. Для ее реализации необходимо создать объект Dataset из библиотеки LightFM. В данный датасет нужно загрузить все имеющиеся в events.csv уникальные visitorid и itemid. Затем разбить датасет на train и test, выбираем точку отсечения по дате события, в пропорции 80 на 20. Далее обучаем модель LightFM и проверяем значение целевой метрики precision at 3 на валидационном датасете.

# Проведенные эксперименты: модели, гиперпараметры, метрики
## Были проведены следующие эксперименты:

### XGBoost (задача классификации)
## Для решения задачи был добавлен признак target со значениями 1 - купил, 0 - не купил. 
## Были получены следующие метрики:
## precision_score =  0.0120
## recall_score =  0.4729
## f1_score =  0.0234
## accuracy =  0.6046

#  CatBoostClassifier  , метрики чуть лучше,

## precision_score =  0.0126
## recall_score =  0.4221
## f1_score =  0.0234
## accuracy =  0.7404


### Даже несмотря на то, что была предпринята попытка уровнять классы, значение метрик получилось не очень высоким. 
### Возможно обогащение датасета даст лучшие результаты.


#  Колоборативная фильтрация
### Эксперимент был проведен на части тестовой выборки. Значение Precision at 3 составило 0.38.

#   ALS (факторизационные машины)
### Для реализации модели был введен новый фактор event_scores. Далее для эксперимента были закодированы столбцы идентификаторов, 
### чтобы можно было преобразовать их в разреженную матрицу для экономии места и чтобы наша модель была способна вычислять 
### все возможные взаимодействия в наборе данных. 
### Были сформированы функции для выдачи рекомендаций: recommend_item_to_user и similar_items_to_item.
### Значение  Precision at 3 составило 0.12

# LightFM
### Эксперименты с гиперпараметрами LightFM: loss='bpr', no_componenst=30 - 0.13% loss='warp', no_components=30 - 1.0% loss='warp',
### no_components=50 - 1.03% loss='warp', no_components=100 - 0.99%
### Таким образом, выбрана модель с гиперпараметрами loss='warp', no_components=50.
### Значение  Precision at 3 составило 0.76

# Описание API
### Сервис работает через отправку GET запроса с параметром visitorid, равным visitorid пользотеля, которому нужно сделать рекоммендации. 
### Сервис доступен по адресу 0.0.0.0:8888
### Endpoint для снятия рекомендаций в формате JSON - 0.0.0.0:8888/recomm 
### Для получения рекомендаций необходимо сделать запрос с параметром visitorid, куда необходимо передать visitorid пользователя, 
### которому нужно предложить рекомендации.       
### Например: 0.0.0.0:8888 - текстовый вывод рекомендаций 0.0.0.0:8888/recomm/?visitorid=3 - endpoint c JSON
### Запуск сервиса и его структура

# просмотр 
##  ###   https://hub.docker.com/repository/docker/markov22/diploma/general

### Для создания образа необходимы следующие файлы:
###   https://hub.docker.com/repository/docker/markov22/diploma/general
###  docker run -p 8888:8888 markov22/diploma:latest 

# Создание контейнера:
   ### docker build -t diploma  .
# Запуск контейнера:
### docker run -d -p 8888:8888 diploma
    
## Просмотр результата:    
### http://127.0.0.1:8888/?visitorid=5
## Для остановки сервиса:
### docker ps -a
### docker stop <docker_id>
# В структуре проекта:

## Dockerfile - контейнер, устанавливающий необходимые библиотеки (flask, pandas, numpy) и запускающий веб-сервис с порта 8888;
## requirements.txt - список необходимых для запуска сервиса библиотек, используется при первом запуске контейнера;
## predictions.py - исполняемый файл сервиса, содержит рекомендательную модель;
## app.py - исполняемый файл сервиса, содержит маршрутизацию;
## вспомогательные файлы
